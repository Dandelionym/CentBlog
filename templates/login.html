<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>登录</title>
	<link rel="stylesheet" href="/static/centBlog/plugins/bs/css/bootstrap.min.css">
	<link rel="stylesheet" href="/static/centBlog/plugins/fa/css/font-awesome.min.css">
	<link rel="stylesheet" href="/static/centBlog/css/color.css">

</head>
<body>
<div class="container">
	<div class="row">
		<div class="col-md-4 col-lg-offset-3 table-bordered" style="padding: 20px; transition: .5s; margin-top: 100px; height: 380px">
			<h1 class="h1 text-center"><i id="status" class="fa fa-user-circle-o blue" style="transition: 1.5s; font-size: 48px"></i></h1>
			<form id="form">
				{% csrf_token %}
				<div class="form-group">
					<label for="user">用户名</label>
					<input type="text" id="user" class="form-control">
				</div>
				<div class="form-group">
					<label for="pswd">密码</label>
					<input type="password" id="pswd" class="form-control">
				</div>
				<div class="form-group">
					<label for="valid">验证码</label>
					<div class="row">
						<div class="col-md-6">
							<input type="text" id="valid" class="form-control">
						</div>
						<div class="col-md-6">
							<img id="valid_code_img" src="/get_valid_img/" alt="验证码" width=auto height="35" >
						</div>
					</div>
				</div>

				<div class="form-group">
					<input type="button" id="login" value="登录" class="btn btn-default pull-right">
					<input type="button" id="register" value="注册" class="btn btn-default pull-left">
				</div>
			</form>
			<div id="assert_valid" class="alert alert-danger alert-dismissible text-center" role="alert" style="margin-top: 80px; display: none">

			</div>
		</div>

	</div>
</div>


<script type="text/javascript" src="/static/centBlog/plugins/jquery-3.4.1.js"></script>
<script type="text/javascript" src="/static/centBlog/plugins/bs/js/bootstrap.min.js"></script>
<script>
	// Get valid image by flushing local page. (Also can be replaced by ajax)
	$('#valid_code_img').click(function () {  $(this)[0].src += "?"  })

	// Loginning confirm
	$('#login').click(function () {

	    $.ajax({
		    url: '',
		    type: 'POST',
		    data: {
		        user: $('#user').val(),
			    password: $('#pswd').val(),
			    valid_code: $('#valid').val(),
			    csrfmiddlewaretoken: $("[name='csrfmiddlewaretoken']").val(),
		    },
		    success: function (args) {
			    if(args.status){
			        let icon = $('#status')
			        icon.removeClass('fa-user-circle-o blue')
			        icon.addClass('fa-check-circle green')
				    setTimeout(function () {
			            location.href = '/index/'
                    }, 1500)
			    }else{
			        let box = $('#assert_valid')
					box.text(args.msg)
				    box.fadeIn(1000)
				    setTimeout(function () {
						box.fadeOut(1000)
                    }, 1000)
			    }
            }
	    })
    })
</script>
</body>
</html>